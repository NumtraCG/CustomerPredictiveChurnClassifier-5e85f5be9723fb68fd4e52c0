import json
import Connectors
import Transformations
import AutoML
try:
    CustomerPredictiveChurnClassifier_DBFS = Connectors.DBFSConnector.fetch(
        [], {}, "5e85f5be9723fb68fd4e52c1", spark, "{'url': '/Demo/PredictiveChurnTraining.csv', 'file_type': 'Delimeted', 'dbfs_token': 'dapi0ef076722999cf4cd8859e9aafdb7b76', 'dbfs_domain': 'westus.azuredatabricks.net', 'delimiter': ',', 'is_header': 'Use Header Line'}")

except Exception as ex:
    print(ex)
try:
    CustomerPredictiveChurnClassifier_AutoFE = Transformations.TransformationMain.run(["5e85f5be9723fb68fd4e52c1"], {"5e85f5be9723fb68fd4e52c1": CustomerPredictiveChurnClassifier_DBFS}, "5e85f5be9723fb68fd4e52c2", spark, json.dumps({"FE": [{"transformationsData": {"feature_label": "State"}, "feature": "State", "type": "string", "selected": "True", "replaceby": "max", "stats": {"count": "660", "mean": "", "stddev": "", "min": "AK", "max": "WY", "missing": "0"}, "transformation": "String Indexer"}, {"feature": "Account_Length", "transformation": "", "type": "numeric", "replaceby": "mean", "selected": "True", "stats": {"count": "660", "mean": "101.36", "stddev": "39.94", "min": "1", "max": "232", "missing": "0"}}, {"feature": "Area_Code", "transformation": "", "type": "numeric", "replaceby": "mean", "selected": "True", "stats": {"count": "660", "mean": "437.03", "stddev": "42.43", "min": "408", "max": "510", "missing": "0"}}, {"transformationsData": {"feature_label": "Phone"}, "feature": "Phone", "type": "string", "selected": "True", "replaceby": "max", "stats": {"count": "660", "mean": "", "stddev": "", "min": "327-3954", "max": "422-8344", "missing": "0"}, "transformation": "String Indexer"}, {"transformationsData": {"feature_label": "Intl_Plan"}, "feature": "Intl_Plan", "type": "string", "selected": "True", "replaceby": "max", "stats": {"count": "660", "mean": "", "stddev": "", "min": "no", "max": "yes", "missing": "0"}, "transformation": "String Indexer"}, {"transformationsData": {"feature_label": "VMail_Plan"}, "feature": "VMail_Plan", "type": "string", "selected": "True", "replaceby": "max", "stats": {"count": "660", "mean": "", "stddev": "", "min": "no", "max": "yes", "missing": "0"}, "transformation": "String Indexer"}, {"feature": "VMail_Message", "transformation": "", "type": "numeric", "replaceby": "mean", "selected": "True", "stats": {"count": "660", "mean": "7.91", "stddev": "13.58", "min": "0", "max": "46", "missing": "0"}}, {"feature": "Day_Mins", "type": "real", "selected": "True", "replaceby": "mean", "stats": {"count": "660", "mean": "177.2", "stddev": "54.61", "min": "17.6", "max": "335.5", "missing": "0"}, "transformation": ""}, {"feature": "Day_Calls", "transformation": "", "type": "numeric", "replaceby": "mean", "selected": "True", "stats": {"count": "660", "mean": "99.72", "stddev": "20.76", "min": "42", "max": "163", "missing": "0"}}, {"feature": "Day_Charge", "type": "real", "selected": "True", "replaceby": "mean", "stats": {"count": "660", "mean": "30.12", "stddev": "9.28", "min": "2.99", "max": "57.04", "missing": "0"}, "transformation": ""}, {"feature": "Eve_Mins", "type": "real", "selected": "True", "replaceby": "mean", "stats": {"count": "660", "mean": "202.05", "stddev": "48.95", "min": "42.5", "max": "354.2", "missing": "0"}, "transformation": ""}, {"feature": "Eve_Calls", "transformation": "", "type": "numeric", "replaceby": "mean", "selected": "True", "stats": {"count": "660", "mean": "99.89", "stddev": "20.83", "min": "36", "max": "164", "missing": "0"}}, {"feature": "Eve_Charge", "type": "real", "selected": "True", "replaceby": "mean", "stats": {"count": "660", "mean": "17.17", "stddev": "4.16", "min": "3.61", "max": "30.11", "missing": "0"}, "transformation": ""}, {"feature": "Night_Mins", "type": "real", "selected": "True", "replaceby": "mean", "stats": {
                                                                                      "count": "660", "mean": "201.86", "stddev": "48.33", "min": "57.5", "max": "352.5", "missing": "0"}, "transformation": ""}, {"feature": "Night_Calls", "transformation": "", "type": "numeric", "replaceby": "mean", "selected": "True", "stats": {"count": "660", "mean": "99.48", "stddev": "20.08", "min": "33", "max": "157", "missing": "0"}}, {"feature": "Night_Charge", "type": "real", "selected": "True", "replaceby": "mean", "stats": {"count": "660", "mean": "9.08", "stddev": "2.17", "min": "2.59", "max": "15.86", "missing": "0"}, "transformation": ""}, {"feature": "Intl_Mins", "type": "real", "selected": "True", "replaceby": "mean", "stats": {"count": "660", "mean": "10.28", "stddev": "2.84", "min": "0.0", "max": "20.0", "missing": "0"}, "transformation": ""}, {"feature": "total_Mins", "type": "real", "selected": "True", "replaceby": "mean", "stats": {"count": "660", "mean": "591.38", "stddev": "87.57", "min": "284.3", "max": "882.2", "missing": "0"}, "transformation": ""}, {"feature": "Intl_Calls", "transformation": "", "type": "numeric", "replaceby": "mean", "selected": "True", "stats": {"count": "660", "mean": "4.47", "stddev": "2.45", "min": "0", "max": "16", "missing": "0"}}, {"feature": "Intl_Charge", "type": "real", "selected": "True", "replaceby": "mean", "stats": {"count": "660", "mean": "2.78", "stddev": "0.77", "min": "0.0", "max": "5.4", "missing": "0"}, "transformation": ""}, {"feature": "Total_Charge", "type": "real", "selected": "True", "replaceby": "mean", "stats": {"count": "660", "mean": "59.16", "stddev": "10.32", "min": "25.52", "max": "90.46", "missing": "0"}, "transformation": ""}, {"feature": "CustServ_Calls", "transformation": "", "type": "numeric", "replaceby": "mean", "selected": "True", "stats": {"count": "660", "mean": "1.58", "stddev": "1.35", "min": "0", "max": "8", "missing": "0"}}, {"transformationsData": {"feature_label": "cluster_labels"}, "feature": "cluster_labels", "type": "string", "selected": "True", "replaceby": "max", "stats": {"count": "660", "mean": "", "stddev": "", "min": "day_callers", "max": "vmailers", "missing": "0"}, "transformation": "String Indexer"}, {"feature": "Churn", "transformation": "", "type": "numeric", "replaceby": "mean", "selected": "True", "stats": {"count": "660", "mean": "0.11", "stddev": "0.32", "min": "0", "max": "1", "missing": "0"}}, {"feature": "State_transform", "transformation": "", "type": "real", "selected": "True", "stats": {"count": "660", "mean": "21.07", "stddev": "14.41", "min": "0.0", "max": "50.0", "missing": "0"}}, {"feature": "Phone_transform", "transformation": "", "type": "real", "selected": "True", "stats": {"count": "660", "mean": "329.5", "stddev": "190.67", "min": "0.0", "max": "659.0", "missing": "0"}}, {"feature": "Intl_Plan_transform", "transformation": "", "type": "numeric", "selected": "True", "stats": {"count": "660", "mean": "0.08", "stddev": "0.28", "min": "0", "max": "1", "missing": "0"}}, {"feature": "VMail_Plan_transform", "transformation": "", "type": "numeric", "selected": "True", "stats": {"count": "660", "mean": "0.27", "stddev": "0.45", "min": "0", "max": "1", "missing": "0"}}, {"feature": "cluster_labels_transform", "transformation": "", "type": "real", "selected": "True", "stats": {"count": "660", "mean": "2.36", "stddev": "1.7", "min": "0.0", "max": "5.0", "missing": "0"}}]}))

except Exception as ex:
    print(ex)
try:
    AutoML.functionClassification(CustomerPredictiveChurnClassifier_AutoFE, ["State", "Account_Length", "Area_Code", "Phone", "Intl_Plan", "VMail_Plan", "VMail_Message", "Day_Mins", "Day_Calls", "Day_Charge",
                                                                             "Eve_Mins", "Eve_Calls", "Eve_Charge", "Night_Mins", "Night_Calls", "Night_Charge", "Intl_Mins", "total_Mins", "Intl_Calls", "Intl_Charge", "Total_Charge", "CustServ_Calls", "cluster_labels"], "Churn")

except Exception as ex:
    print(ex)
